---
title: "Tarea 1"
author: "Carlos Crespín"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 1
    code_download: true
    theme: flatly
    highlight: textmate
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```






# Pregunta 1
Descargar los datos
```{r}
library(rio)
data=import("https://github.com/krlos20203563/ASIE_2024-1/raw/main/data_TA1/datos_abiertos_vigilancia_dengue.csv")
```

Ahora procederemos a explorar los estadísticos descriptivos
```{r}
summary(data$edad)
```
También inspeccionaré la estructura de los datos
```{r}
str(data)
```
```{r}
library(dplyr)
```

```{r}
table(data$enfermedad)
```


```{r}
data$enfermedad <- gsub("DENGUE CON SEÑALES DE ALARMA", "con", data$enfermedad)
data$enfermedad <- gsub("DENGUE SIN SEÑALES DE ALARMA", "sin", data$enfermedad)
data$enfermedad <- gsub("DENGUE GRAVE", "grave", data$enfermedad)
```


```{r}
table(data$enfermedad)
```
```{r}
data=filter(data, enfermedad=="con" | enfermedad=="sin" | enfermedad=="grave")
data$enfermedad=as.factor(data$enfermedad)
```

```{r}
table(data$enfermedad)
```

```{r}
summary(data$edad)
```

# Pregunta 2
Se procederá a verificar la edad promedio de los contagiados

Agruparé por las edades por año y calcularé un promedio de las edades por año
```{r}
library(lsr)
EdadxYear = data |>
  group_by(year) |>
  summarise(media = mean(edad, na.rm=T))
EdadxYear
```

## Gráfico de líneas por edades

```{r}
library(ggplot2)
library(ggthemes)

# Crear el gráfico de líneas
library(ggplot2)

ggplot(EdadxYear, aes(x = year, y = media)) +
  geom_line(color = "blue", size = 1.5) +
  geom_point(color = "red", size = 3) +  
  labs(title = "Edad promedio de personas contagiadas de dengue por año",
       x = "Año",
       y = "Edad") +
  theme_economist() +
  theme(legend.key.size = unit(1, "lines"),  # Tamaño de la leyenda
        plot.title = element_text(size = 10))  # Tamaño del título

```



# Pregunta 3
Se responderá si la cantidad de casos varió a lo largo de los años y si varió
según gravedad
```{r}
pregunta3 <- data %>%
  group_by(year) %>%
  summarise(
    total_casos = n(),
    graves = sum(enfermedad == "grave"),
    sin_señales = sum(enfermedad == "sin"),
    con_señales = sum(enfermedad == "con")
  ) 
```


## Graficos

```{r}
library(ggplot2)
library(ggthemes)

grafico_total <- ggplot(pregunta3, aes(x = year, y = total_casos)) +
  geom_line(size=1) +
  geom_point(color = "red", size = 3) +  
  labs(title = "Total de casos de Dengue a lo largo de los años",
       x = "Año",
       y = "Total de casos") +
  theme_update()

grafico_con_alarma <- ggplot(pregunta3, aes(x = year, y = con_señales)) +
  geom_line() +
  geom_point(color = "red", size = 3) +  
  labs(title = "Casos de Dengue con Alarma a lo largo de los años",
       x = "Año",
       y = "Casos con Alarma") +
  theme_stata()

grafico_sin_alarma <- ggplot(pregunta3, aes(x = year, y = sin_señales)) +
  geom_line() +
  geom_point(color = "red", size = 3) +  
  labs(title = "Casos de Dengue sin Alarma a lo largo de los años",
       x = "Año",
       y = "Casos sin Alarma") +
  theme_test()

grafico_graves <- ggplot(pregunta3, aes(x = year, y = graves)) +
  geom_line() +
  geom_point(color = "red", size = 3) +  
  labs(title = "Casos de Dengue Grave a lo largo de los años",
       x = "Año",
       y = "Casos Graves") +
  theme_minimal()

print(grafico_total)
print(grafico_con_alarma)
print(grafico_sin_alarma)
print(grafico_graves)

```



# Pregunta 4

Ahora se procederá a analizar qué provincias fueron más afectadas por contagios
```{r}
pregunta4 <- data %>%
  group_by(departamento, provincia, year) %>%
  summarize(
    con_alarma = sum(enfermedad == "con"),
    sin_alarma = sum(enfermedad == "sin"),
    graves = sum(enfermedad == "graves")
  )

# Mostrar los primeros registros de la base de datos resumida
head(pregunta4)
```

Ahora añadiré el total
```{r}
pregunta4 <- pregunta4 %>%
  mutate(total_contagios = con_alarma + sin_alarma + graves)
head(pregunta4)
```

Data nueva completa ahora sí todo

```{r}
provyear <- pregunta4 %>%
  group_by(departamento, provincia) %>%
  summarise(total_historico = sum(total_contagios))
```

```{r}
summary(provyear$total_historico)
```

Puesto que el tercer cuartil es 3530, todos los datos que estén por encima se 
considerarán muy altos

```{r}
provyear=filter(provyear, total_historico>3530)
```

## Gráfico de puntos
```{r}
library(ggplot2)

# Crear el gráfico de puntos
puntos <- ggplot(provyear, aes(x = departamento, y = total_historico, label = provincia)) +
  geom_point(color = "red", size = 3) +  
  geom_text(size = 1.9, vjust = -0.5) +  
  labs(title = "Provincias con mayor número de casos de dengue",  
       x = "Departamentos", y = "Total de casos") +  
  theme_solarized() +  
  theme(plot.title = element_text(hjust = 0.5),  
        plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"),  
        axis.text.x = element_text(size = 4.5), 
        axis.text.y = element_text(size = 5),  
        axis.title.x = element_text(size = 10),  
        axis.title.y = element_text(size = 10))  

puntos
```

# Pregunta 5

Ahora bien, para analizar la relación primero haremos una suma de cada dato por 
departamento y después realizaremos un heatmap (primera vez que hago uno)

Vamos a explorar primero
```{r}
table(data$departamento)
```
Según lo registra la base de datos, solo se tiene información de 22 departamentos
y NN

Procederemos a limpiar para después crear
```{r}
pregunta5 <- data %>% filter_all(all_vars(. != "\\N"))
table(pregunta5$departamento)
```

Creacion de la data
```{r}
pregunta5 <- pregunta5 %>%
  group_by(departamento) %>%
  summarise(
    total_casos = n(),
    graves = sum(enfermedad == "grave"),
    sin_señales = sum(enfermedad == "sin"),
    con_señales = sum(enfermedad == "con")
  ) 
head(pregunta5)
```

La pregunta me pide analizar la relación entre casos alarmantes no graves y los
asintomaticos. En ese sentido, en la base de datos significa que es la relación 
entre los "con" entre los "sin"

```{r}
pregunta5 <- pregunta5 %>%
  mutate(relacion = con_señales/sin_señales)
head(pregunta5)
```




Ahora realizaré el heatmap

```{r}
library(knitr)
library(heatmap3)
library(plotly)
```

```{r}
# Preparar los datos para el heatmap
heatmap_data <- pregunta5 %>%
  select(con_señales, sin_señales, relacion) %>%
  as.matrix()
rownames(heatmap_data) <- pregunta5$departamento
```



## Heatmap de la relación
```{r}
library(d3heatmap)
d3heatmap(heatmap_data, scale = "column", colors="Spectral",)
```























































